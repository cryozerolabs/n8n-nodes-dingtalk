{
  "name": "æ¡ˆä¾‹_æŠ¥é”€æµç¨‹æå–å‘ç¥¨ä¿¡æ¯è¿›è¡Œæ ¡éªŒå¹¶åé¦ˆ_v0.5.0",
  "nodes": [
    {
      "parameters": {
        "resource": "workflow",
        "operation": "workflow.processes.instances.download",
        "processInstanceId": "={{ $('å®¡æ‰¹ä¸Šä¸‹æ–‡').item.json.å®¡æ‰¹å®ä¾‹ID }}",
        "fileId": "={{ $json.fileId }}"
      },
      "type": "CUSTOM.dingtalkNode",
      "typeVersion": 1,
      "position": [
        224,
        -608
      ],
      "id": "6f0262ad-981e-4045-9c0f-a45767e0f4d7",
      "name": "OAå®¡æ‰¹ ä¸‹è½½å®¡æ‰¹é™„ä»¶",
      "credentials": {
        "dingtalkApi": {
          "id": "mEh0ffWLDuvnPoI3",
          "name": "Dingtalk account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "/***** ğŸ”§ å¯ä¿®æ”¹çš„é…ç½® *****/\nconst TABLE_NAME = 'æŠ¥é”€æ˜ç»†';                     // TableField çš„ name\nconst ATT_LABEL_IN_ROW = 'é™„ä»¶';                   // è¡Œå†…â€œé™„ä»¶â€å­—æ®µçš„ label\n\n/***** é€»è¾‘ *****/\nconst out = $input.all().map(({ json }) => {\n  const res = (json && json.result) || {};\n  const fcv = res.formComponentValues || [];\n\n  const tableNode = fcv.find(fc =>\n    fc.componentType === 'TableField' &&\n    (fc.name === TABLE_NAME)\n  );\n\n  let attachments = [];\n\n  if (tableNode && tableNode.value) {\n    // é’‰é’‰ TableField.value ä¸º JSON å­—ç¬¦ä¸²\n    const rows = JSON.parse(tableNode.value || '[]');\n    for (const row of rows || []) {\n      const cells = Array.isArray(row.rowValue) ? row.rowValue : [];\n      const attCell = cells.find(v =>\n        v && (v.label === ATT_LABEL_IN_ROW)\n      );\n      if (attCell && Array.isArray(attCell.value)) {\n        attachments = attachments.concat(attCell.value); // è¡Œå†…é™„ä»¶å€¼ä¸ºå¯¹è±¡æ•°ç»„\n      }\n    }\n  }\n\n  return { json: { attachments } };\n});\n\nreturn out;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -160,
        -160
      ],
      "id": "2c189156-6dff-40d2-a65a-ac80e20039a4",
      "name": "ä»æ§ä»¶ç»„ä¸­æå–é™„ä»¶åˆ—è¡¨"
    },
    {
      "parameters": {
        "fieldToSplitOut": "attachments",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        48,
        -608
      ],
      "id": "2c32e9dc-7067-47fa-8d24-4da4cf149af9",
      "name": "Split Out"
    },
    {
      "parameters": {
        "content": "## ç¤ºä¾‹ï¼šè·å–æŠ¥é”€å•ï¼Œå¯¹é™„ä»¶ä¸­çš„å‘ç¥¨ocrå¹¶æ ¡éªŒæŠ¥é”€é‡‘é¢\n### æµç¨‹å®ä¾‹\n1. æ·»åŠ ä¸€å¼ jpgå‘ç¥¨ã€ä¸€ä¸ªpdfå‘ç¥¨\n### N8Nå·¥ä½œæµ\n1. é€šè¿‡è§¦å‘å™¨ç›‘å¬æ–°å‘èµ·çš„å®¡æ‰¹æµ\n2. è·å–å®¡æ‰¹ä¸­çš„é™„ä»¶åˆ—è¡¨\n3. ä½¿ç”¨AIå¯¹å›¾ç‰‡OCRæå–å‘ç¥¨ä¿¡æ¯\n4. å°†ç»“æœåé¦ˆç»™å®¡æ‰¹æµï¼ˆè¯„è®ºã€å›å†™å®¡æ‰¹å®ä¾‹",
        "height": 400,
        "width": 992,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -1008,
        -752
      ],
      "id": "0d7638a4-c46b-4b90-a628-a2df26415815",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "resource": "workflow",
        "operation": "workflow.processes.instances",
        "processInstanceId": "={{ $('å®¡æ‰¹ä¸Šä¸‹æ–‡').item.json['å®¡æ‰¹å®ä¾‹ID'] }}"
      },
      "type": "CUSTOM.dingtalkNode",
      "typeVersion": 1,
      "position": [
        -368,
        -160
      ],
      "id": "920ddf21-41df-4a5d-aa23-d797059e9435",
      "name": "OAå®¡æ‰¹ è·å–å•ä¸ªå®¡æ‰¹å®ä¾‹è¯¦æƒ…",
      "alwaysOutputData": false,
      "retryOnFail": false,
      "credentials": {
        "dingtalkApi": {
          "id": "mEh0ffWLDuvnPoI3",
          "name": "Dingtalk account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "/***** ğŸ”§ å¯ä¿®æ”¹çš„é…ç½® *****/\nconst ROOT_ATTACHMENT_NAME = 'é™„ä»¶';   // æ ¹å±‚é™„ä»¶æ§ä»¶çš„ name\n\n/***** é€»è¾‘ *****/\nconst out = $input.all().map(({ json }) => {\n  const res = (json && json.result) || {};\n  const fcv = res.formComponentValues || [];\n\n  const node = fcv.find(fc =>\n    fc.componentType === 'DDAttachment' &&\n    (fc.name === ROOT_ATTACHMENT_NAME)\n  );\n\n  // é’‰é’‰ DDAttachment.value ä¸º JSON å­—ç¬¦ä¸²\n  const attachments = node && node.value ? JSON.parse(node.value || '[]') : [];\n\n  return { json: { attachments } };\n});\n\nreturn out;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -160,
        -304
      ],
      "id": "5b627f59-eeb2-4417-91a6-c81ee2ac31db",
      "name": "ä»æ ¹å±‚é™„ä»¶æ§ä»¶æå–åˆ—è¡¨"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "b80b7b2c-b0df-41b5-8c02-89ed718f5671",
                    "leftValue": "={{ $('Split Out').item.json.fileType }}",
                    "rightValue": "pdf",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "PDFæ ¼å¼"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Split Out').item.json.fileType }}",
                    "rightValue": "^(?:jpg|jpeg|png|gif|bmp|webp|tif|tiff)$",
                    "operator": {
                      "type": "string",
                      "operation": "regex"
                    },
                    "id": "d505d6fa-76af-4c45-8ab3-92028ee6847e"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "å›¾ç‰‡æ ¼å¼"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        400,
        -608
      ],
      "id": "2474e87b-d946-4518-b3bf-5b7fcc040792",
      "name": "Switch"
    },
    {
      "parameters": {
        "operation": "pdf",
        "options": {}
      },
      "id": "98849f5d-e189-4217-9156-f026740ae524",
      "name": "Extract from File",
      "type": "n8n-nodes-base.extractFromFile",
      "position": [
        720,
        -736
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "url": "={{ $json.result.downloadUri }}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        560,
        -736
      ],
      "id": "fb109bc0-5989-443e-9633-ef4bdafd86d9",
      "name": "ä¸‹è½½PDF"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        976,
        -528
      ],
      "id": "669df023-bf95-4a87-91f0-b5ec2f66d5ff",
      "name": "Merge1"
    },
    {
      "parameters": {
        "resource": "image",
        "operation": "analyze",
        "modelId": {
          "__rl": true,
          "value": "Qwen/Qwen3-VL-8B-Instruct",
          "mode": "id"
        },
        "text": "## è§’è‰²\n\nä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„â€œå‘ç¥¨ä¿¡æ¯æŠ½å–å™¨â€ã€‚è¾“å…¥æ˜¯ä¸€æ®µå‘ç¥¨æ–‡å­—ï¼ˆå¯èƒ½æ¥è‡ª OCRã€é‚®ä»¶æ­£æ–‡æˆ–èŠå¤©ç²˜è´´ï¼‰ï¼Œè¾“å‡ºæ˜¯ä¸¥æ ¼æœ‰æ•ˆçš„ JSONï¼Œé€‚åˆç›´æ¥å†™å…¥æ•°æ®åº“/Google Sheetsã€‚\n\n## ä»»åŠ¡\nä»ç»™å®šçš„å‘ç¥¨æ–‡æœ¬ä¸­è¯†åˆ«å¹¶æŠ½å–å­—æ®µï¼Œè¿”å›å•ä¸ª JSON å¯¹è±¡ï¼Œæ”¾åœ¨ä¸€ä¸ªæ ‡è®°ä»£ç å—é‡Œï¼ˆjson ... ï¼‰ã€‚ä¸è¦è¾“å‡ºä»»ä½•è§£é‡Šã€æ³¨é‡Šæˆ–å¤šä½™å­—ç¬¦ã€‚\n\n## è¾“å‡ºè¦æ±‚\n\nä»…è¾“å‡ºä¸€ä¸ª JSON ä»£ç å—ï¼Œä¸å¾—åŒ…å«é¢å¤–æ–‡å­—ã€‚\n\nä¸å­˜åœ¨æˆ–ä¸ç¡®å®šçš„å€¼ä¸€å¾‹å¡« nullã€‚\n\næ—¥æœŸç»Ÿä¸€ä¸º YYYY-MM-DDï¼ˆISO 8601ï¼‰ï¼›\n\né‡‘é¢/æ•°é‡ç­‰æ•°å€¼å­—æ®µç”¨ æ•°å­—ç±»å‹ï¼ˆè€Œéå­—ç¬¦ä¸²ï¼‰ï¼Œä¿ç•™ç²¾åº¦ä½†ä¸è¦æ·»åŠ è´§å¸ç¬¦å·æˆ–åƒåˆ†ä½ã€‚\n\nç¨ç‡ä½¿ç”¨å°æ•°ï¼ˆä¾‹å¦‚ 1% â†’ 0.01ï¼‰ï¼Œå¹¶åŒæ—¶æä¾›æ˜¾ç¤ºå­—æ®µï¼ˆä¾‹å¦‚ \"1%\"ï¼‰ã€‚\n\nitems æ•°ç»„å¿…é¡»å­˜åœ¨ï¼›è‹¥æ— è¡Œé¡¹ç›®ï¼Œè¾“å‡ºç©ºæ•°ç»„ []ã€‚\n\n## å­—æ®µå®šä¹‰ï¼ˆSchemaï¼‰\n\n{\n  \"invoice\": {\n    \"title\": \"string|null\",\n    \"number\": \"string|null\",\n    \"issue_date\": \"YYYY-MM-DD|null\",\n    \"currency\": \"string|null\",\n    \"buyer\": {\n      \"name\": \"string|null\",\n      \"tax_id\": \"string|null\",\n      \"note\": \"string|null\"\n    },\n    \"seller\": {\n      \"name\": \"string|null\",\n      \"tax_id\": \"string|null\"\n    },\n    \"items\": [\n      {\n        \"name\": \"string|null\",\n        \"spec\": \"string|null\",\n        \"unit\": \"string|null\",\n        \"quantity\": \"number|null\",\n        \"unit_price\": \"number|null\",\n        \"amount_without_tax\": \"number|null\",\n        \"tax_rate\": \"number|null\",\n        \"tax_rate_display\": \"string|null\",\n        \"tax_amount\": \"number|null\"\n      }\n    ],\n    \"totals\": {\n      \"amount_without_tax\": \"number|null\",\n      \"tax_total\": \"number|null\",\n      \"amount_with_tax\": \"number|null\"\n    },\n    \"issuer\": \"string|null\"\n  }\n}",
        "imageUrls": "={{ $json.result.downloadUri }}",
        "options": {
          "maxTokens": 256000
        }
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.8,
      "position": [
        560,
        -512
      ],
      "id": "0419e059-4f48-43d1-b872-09f768f4c45c",
      "name": "OCR",
      "retryOnFail": false,
      "executeOnce": false,
      "alwaysOutputData": false,
      "notesInFlow": false,
      "credentials": {
        "openAiApi": {
          "id": "MTUSRCEVOUpFnWmZ",
          "name": "ç¡…åŸºæµåŠ¨-YQ"
        }
      }
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "tencent/Hunyuan-MT-7B",
          "mode": "id"
        },
        "messages": {
          "values": [
            {
              "content": "=## è§’è‰²\n\nä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„â€œå‘ç¥¨ä¿¡æ¯æŠ½å–å™¨â€ã€‚è¾“å…¥æ˜¯ä¸€æ®µå‘ç¥¨æ–‡å­—ï¼ˆå¯èƒ½æ¥è‡ª OCRã€é‚®ä»¶æ­£æ–‡æˆ–èŠå¤©ç²˜è´´ï¼‰ï¼Œè¾“å‡ºæ˜¯ä¸¥æ ¼æœ‰æ•ˆçš„ JSONï¼Œé€‚åˆç›´æ¥å†™å…¥æ•°æ®åº“/Google Sheetsã€‚\n\n## ä»»åŠ¡\nä»ç»™å®šçš„å‘ç¥¨æ–‡æœ¬ä¸­è¯†åˆ«å¹¶æŠ½å–å­—æ®µï¼Œè¿”å›å•ä¸ª JSON å¯¹è±¡ï¼Œæ”¾åœ¨ä¸€ä¸ªæ ‡è®°ä»£ç å—é‡Œï¼ˆjson ... ï¼‰ã€‚ä¸è¦è¾“å‡ºä»»ä½•è§£é‡Šã€æ³¨é‡Šæˆ–å¤šä½™å­—ç¬¦ã€‚\n\n## è¾“å‡ºè¦æ±‚\n\nä»…è¾“å‡ºä¸€ä¸ª JSON ä»£ç å—ï¼Œä¸å¾—åŒ…å«é¢å¤–æ–‡å­—ã€‚\n\nä¸å­˜åœ¨æˆ–ä¸ç¡®å®šçš„å€¼ä¸€å¾‹å¡« nullã€‚\n\næ—¥æœŸç»Ÿä¸€ä¸º YYYY-MM-DDï¼ˆISO 8601ï¼‰ï¼›\n\né‡‘é¢/æ•°é‡ç­‰æ•°å€¼å­—æ®µç”¨ æ•°å­—ç±»å‹ï¼ˆè€Œéå­—ç¬¦ä¸²ï¼‰ï¼Œä¿ç•™ç²¾åº¦ä½†ä¸è¦æ·»åŠ è´§å¸ç¬¦å·æˆ–åƒåˆ†ä½ã€‚\n\nç¨ç‡ä½¿ç”¨å°æ•°ï¼ˆä¾‹å¦‚ 1% â†’ 0.01ï¼‰ï¼Œå¹¶åŒæ—¶æä¾›æ˜¾ç¤ºå­—æ®µï¼ˆä¾‹å¦‚ \"1%\"ï¼‰ã€‚\n\nitems æ•°ç»„å¿…é¡»å­˜åœ¨ï¼›è‹¥æ— è¡Œé¡¹ç›®ï¼Œè¾“å‡ºç©ºæ•°ç»„ []ã€‚\n\n## å­—æ®µå®šä¹‰ï¼ˆSchemaï¼‰\n\n{\n  \"invoice\": {\n    \"title\": \"string|null\",\n    \"number\": \"string|null\",\n    \"issue_date\": \"YYYY-MM-DD|null\",\n    \"currency\": \"string|null\",\n    \"buyer\": {\n      \"name\": \"string|null\",\n      \"tax_id\": \"string|null\",\n      \"note\": \"string|null\"\n    },\n    \"seller\": {\n      \"name\": \"string|null\",\n      \"tax_id\": \"string|null\"\n    },\n    \"items\": [\n      {\n        \"name\": \"string|null\",\n        \"spec\": \"string|null\",\n        \"unit\": \"string|null\",\n        \"quantity\": \"number|null\",\n        \"unit_price\": \"number|null\",\n        \"amount_without_tax\": \"number|null\",\n        \"tax_rate\": \"number|null\",\n        \"tax_rate_display\": \"string|null\",\n        \"tax_amount\": \"number|null\"\n      }\n    ],\n    \"totals\": {\n      \"amount_without_tax\": \"number|null\",\n      \"tax_total\": \"number|null\",\n      \"amount_with_tax\": \"number|null\"\n    },\n    \"issuer\": \"string|null\"\n  }\n}\n\n## æ–‡æœ¬\n{{ $json.text }}"
            }
          ]
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.8,
      "position": [
        864,
        -736
      ],
      "id": "f2e76ee6-9e7c-4ba2-80a5-21f5677c4989",
      "name": "PDFæ ¼å¼åŒ–",
      "credentials": {
        "openAiApi": {
          "id": "MTUSRCEVOUpFnWmZ",
          "name": "ç¡…åŸºæµåŠ¨-YQ"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "c1e2172a-9a9e-47cb-b875-774f7cc299a8",
              "name": "content",
              "value": "={{ $json.message.content }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1136,
        -736
      ],
      "id": "d10a8140-2f89-44b7-8aaf-8343794e64da",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "jsCode": "/***** å·¥å…·å‡½æ•° *****/\nfunction stripCodeFence(s) {\n  if (typeof s !== 'string') return s;\n  const m = s.match(/```json\\s*([\\s\\S]*?)```/i) || s.match(/```\\s*([\\s\\S]*?)```/i);\n  return m ? m[1].trim() : s.trim();\n}\nfunction toJson(payload) {\n  if (!payload) return null;\n  if (typeof payload === 'object') return payload;\n  const s = stripCodeFence(String(payload));\n  try { return JSON.parse(s); } catch { return null; }\n}\nfunction nvl(v){\n  if (v == null) return null;\n  const t = String(v).trim();\n  if (t === '' || /^null$/i.test(t) || t === 'æœªæä¾›') return null;\n  return v;\n}\nfunction num(v){\n  if (v == null || v === '') return null;\n  if (typeof v === 'number') return v;\n  const n = parseFloat(String(v).replace(/[^\\d.\\-]/g,''));\n  return Number.isFinite(n) ? n : null;\n}\nfunction normDate(s){\n  if(!s) return null;\n  const t = String(s).replace('å¹´','-').replace('æœˆ','-').replace('æ—¥','');\n  const m = t.match(/(\\d{4})[-/.\\s](\\d{1,2})[-/.\\s](\\d{1,2})/);\n  if(!m) return null;\n  const [, y, mo, d] = m;\n  return `${y}-${String(mo).padStart(2,'0')}-${String(d).padStart(2,'0')}`;\n}\nfunction normCcy(s){\n  if(!s) return null;\n  const t = String(s).toUpperCase();\n  if (/[Â¥ï¿¥]|äººæ°‘å¸|CNY/.test(t)) return 'CNY';\n  if (/USD|\\$|ç¾å…ƒ/.test(t)) return 'USD';\n  return null;\n}\n\n/***** è§„èŒƒåŒ–å•å¼ å‘ç¥¨ç»“æ„ *****/\nfunction normalizeInvoice(raw){\n  if (!raw || !raw.invoice) return null;\n  const inv = raw.invoice;\n  const items = Array.isArray(inv.items) ? inv.items.map(it => ({\n    name: (nvl(it?.name) ?? null)?.replace(/^\\*+|\\*+$/g,'') || null,\n    spec: nvl(it?.spec) ?? null,\n    unit: nvl(it?.unit) ?? null,\n    quantity: num(it?.quantity),\n    unit_price: num(it?.unit_price),\n    amount_without_tax: num(it?.amount_without_tax),\n    tax_rate: (it?.tax_rate === 0) ? 0 : num(it?.tax_rate),\n    tax_rate_display: nvl(it?.tax_rate_display) ?? null,\n    tax_amount: num(it?.tax_amount),\n  })) : [];\n\n  return {\n    title: nvl(inv.title) ?? null,\n    number: nvl(inv.number) ?? null,\n    issue_date: normDate(inv.issue_date),\n    currency: normCcy(inv.currency),\n    buyer: { name: nvl(inv?.buyer?.name) ?? null, tax_id: nvl(inv?.buyer?.tax_id) ?? null, note: nvl(inv?.buyer?.note) ?? null },\n    seller: { name: nvl(inv?.seller?.name) ?? null, tax_id: nvl(inv?.seller?.tax_id) ?? null },\n    items,\n    totals: {\n      amount_without_tax: num(inv?.totals?.amount_without_tax),\n      tax_total: num(inv?.totals?.tax_total),\n      amount_with_tax: num(inv?.totals?.amount_with_tax),\n    },\n    issuer: nvl(inv.issuer) ?? null,\n  };\n}\n\n/***** ä¸»ä½“ï¼šè¯»å– Merge è¾“å‡ºçš„æ‰€æœ‰ itemï¼Œå¹¶æ±‡æ€» *****/\nconst invoices = [];\nconst errors = [];\n\nfor (const it of $input.all()) {\n  const content = it.json?.content ?? it.json; // ä½ çš„ç¤ºä¾‹é‡Œæ•°æ®åœ¨ json.content\n  const parsed = toJson(content);\n  const normalized = normalizeInvoice(parsed);\n  if (normalized) invoices.push(normalized);\n  else errors.push({ reason: 'PARSE_FAIL_OR_NO_INVOICE', rawSnippet: String(content).slice(0, 200) });\n}\n\n/***** ç”Ÿæˆä¸€ä¸ªç®€å•æ±‡æ€» *****/\nconst summary = invoices.reduce((acc, inv) => {\n  acc.count += 1;\n  acc.amount_without_tax = +( (acc.amount_without_tax ?? 0) + (inv.totals.amount_without_tax ?? 0) ).toFixed(2);\n  acc.tax_total         = +( (acc.tax_total ?? 0)         + (inv.totals.tax_total ?? 0) ).toFixed(2);\n  acc.amount_with_tax   = +( (acc.amount_with_tax ?? 0)   + (inv.totals.amount_with_tax ?? 0) ).toFixed(2);\n  return acc;\n}, { count: 0, amount_without_tax: 0, tax_total: 0, amount_with_tax: 0 });\n\nreturn [{ json: { invoices, summary, errors } }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1136,
        -528
      ],
      "id": "302f4f02-bb78-4a17-a983-bbb4a051a165",
      "name": "æ±‡æ€»å‘ç¥¨ä¿¡æ¯"
    },
    {
      "parameters": {
        "content": "## 3. è§£æé™„ä»¶ä¸­çš„å‘ç¥¨ä¿¡æ¯\n1. å¦‚æœæ˜¯pdfï¼Œæå–æ–‡å­—ï¼Œè®©aiå¤„ç†æ ¼å¼åŒ–æˆjson\n2. å¦‚æœæ˜¯å›¾ç‰‡ï¼Œåˆ™ä½¿ç”¨ocræå–æˆjson\n3. æœ€åï¼Œå†æ±‡æ€»æ‰€æœ‰çš„ç»“æœ",
        "height": 400,
        "width": 1312,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        0,
        -752
      ],
      "id": "56b2e18b-3110-4832-8aa7-9264abfd11a8",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "content": "## TODO\n- è®°å½•å‘ç¥¨ä½¿ç”¨æ¬¡æ•°\n- è°ƒç”¨apiè¿›è¡Œå‘ç¥¨éªŒçœŸ",
        "height": 624,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        0,
        -336
      ],
      "id": "6c6f369d-84fa-48ef-a9e7-cc9aa31193ba",
      "name": "Sticky Note3"
    },
    {
      "parameters": {
        "jsCode": "// ä¾èµ–èŠ‚ç‚¹\nconst formItem = $(\"OAå®¡æ‰¹ è·å–å•ä¸ªå®¡æ‰¹å®ä¾‹è¯¦æƒ…\").first();\nconst aggItem  = $(\"æ±‡æ€»å‘ç¥¨ä¿¡æ¯\").first();\n\nconst form = formItem?.json?.result || {};\nconst agg  = aggItem?.json || {};\nconst invoices = Array.isArray(agg.invoices) ? agg.invoices : [];\nconst summary  = agg.summary || {};\n\n// å–è¡¨å•å­—æ®µ\nconst fcv = form.formComponentValues || [];\nconst getByName = (name) => (fcv.find(x => x.name === name) || {}).value || null;\n\nconst formTotalStr  = getByName('æŠ¥é”€æ€»é¢ï¼ˆå…ƒï¼‰') || '0';\nconst recordTimeStr = getByName('å…¥è´¦æ—¶é—´'); // å¦‚ \"2025-10-28 15:29\"\n\n// å·¥å…·\nconst toNum = (v) => {\n  if (v == null || v === '') return 0;\n  if (typeof v === 'number') return v;\n  const n = parseFloat(String(v).replace(/[^\\d.\\-]/g,''));\n  return Number.isFinite(n) ? n : 0;\n};\nfunction parseDateOnly(s) {\n  if (!s) return null;\n  const t = String(s).trim().replace('å¹´','-').replace('æœˆ','-').replace('æ—¥','');\n  const m = t.match(/(\\d{4})[-/.\\s](\\d{1,2})[-/.\\s](\\d{1,2})/);\n  if (!m) return null;\n  const [, y, mo, d] = m;\n  return new Date(`${y}-${String(mo).padStart(2,'0')}-${String(d).padStart(2,'0')}T00:00:00Z`);\n}\n\n// === æ ¡éªŒ Aï¼šå‘ç¥¨åˆè®¡å¿…é¡» â‰¥ æŠ¥é”€æ€»é¢ï¼ˆå®¹å·® 0.01ï¼‰===\nconst tol = 0.01;\nconst formTotal    = toNum(formTotalStr);\nconst invoiceTotal = toNum(summary.amount_with_tax);\nconst amountPass   = (invoiceTotal + tol) >= formTotal;\nconst shortfall    = Math.max(0, +(formTotal - invoiceTotal).toFixed(2)); // å‘ç¥¨å°‘äº†å¤šå°‘ï¼ˆä»…ç”¨äºæç¤ºï¼‰\n\n// === æ ¡éªŒ Bï¼šå¼€ç¥¨æ—¥æœŸ â‰¤ å…¥è´¦æ—¥æœŸ ===\nconst recordDate = parseDateOnly(recordTimeStr);\nlet datePass = true;\nconst lateList = [];\nif (recordDate) {\n  for (const inv of invoices) {\n    const d = parseDateOnly(inv?.issue_date);\n    if (!d) continue;\n    if (d.getTime() > recordDate.getTime()) {\n      datePass = false;\n      lateList.push(`${inv?.number || 'æœªçŸ¥ç¥¨å·'}(${inv?.issue_date || 'æ— æ—¥æœŸ'})`);\n    }\n  }\n} else {\n  datePass = false;\n}\n\n// === ç»„è£…è¾“å‡º ===\nconst reasons = [];\nif (!amountPass) reasons.push(`å‘ç¥¨åˆè®¡å°äºæŠ¥é”€æ€»é¢ï¼Œå·®é¢Â¥${shortfall.toFixed(2)}`);\nif (!datePass) {\n  if (!recordDate) reasons.push('ç¼ºå°‘å…¥è´¦æ—¶é—´');\n  else reasons.push(`å­˜åœ¨å‘ç¥¨å¼€ç¥¨æ—¥æœŸæ™šäºå…¥è´¦æ—¶é—´ï¼š${lateList.join('ã€')}`);\n}\n\nconst pass = reasons.length === 0;\nconst message = pass ? 'æ ¡éªŒé€šè¿‡' : `ä¸é€šè¿‡ï¼š${reasons.join('ï¼›')}`;\n\nreturn [{ json: { pass, message } }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        304,
        -224
      ],
      "id": "53ff18f2-a5a0-45f3-baad-013529689475",
      "name": "å¯¹æ¯”æŠ¥é”€æ€»é¢"
    },
    {
      "parameters": {
        "resource": "workflow",
        "operation": "workflow.processes.instancesUpdate",
        "opUserId": "={{ $('å®¡æ‰¹ä¸Šä¸‹æ–‡').first().json['æ“ä½œç”¨æˆ·'] }}",
        "processCode": "={{ $('å®¡æ‰¹ä¸Šä¸‹æ–‡').item.json['å®¡æ‰¹æµçš„å”¯ä¸€ç '] }}",
        "processInstanceId": "={{ $('å®¡æ‰¹ä¸Šä¸‹æ–‡').item.json['å®¡æ‰¹å®ä¾‹ID'] }}",
        "variables": {
          "mappingMode": "defineBelow",
          "value": {
            "TextareaField_Y37FR13HQV40": "{{ $json.message }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "OpenDataField_DNYN0JH6CQO0",
              "displayName": "DDBizSuite / å…³è”ç”³è¯·å• (relationCost)",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "readOnly": false,
              "type": "string",
              "removed": true
            },
            {
              "id": "TableField_19H82SZV4XVK0",
              "displayName": "DDBizSuite / è¡Œç¨‹ (addTravelDetail)",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "readOnly": false,
              "type": "string",
              "removed": true
            },
            {
              "id": "OpenDataField_1EDJ5Z9QVY680",
              "displayName": "DDBizSuite / å…³è”å¤–å‡ºå• (relationOuting)",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "readOnly": false,
              "type": "string",
              "removed": true
            },
            {
              "id": "OpenDataField_3SGL04MD9IO0",
              "displayName": "DDBizSuite / å…³è”å¤‡ç”¨é‡‘ (relationReserve)",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "readOnly": false,
              "type": "string",
              "removed": true
            },
            {
              "id": "TableField_X8UL2UZUMHC0",
              "displayName": "DDBizSuite / æŠ¥é”€æ˜ç»† (addReimbursementDetail)",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "readOnly": false,
              "type": "string",
              "removed": true
            },
            {
              "id": "TableField_AOAI6W2ICQO0",
              "displayName": "DDBizSuite / æ”¶æ¬¾é‡‘é¢åˆè®¡ (mergePaymentDetail)",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "readOnly": false,
              "type": "string",
              "removed": true
            },
            {
              "id": "TableField_U5TC9PLF7OW0",
              "displayName": "DDBizSuite / å…¬å¸æ”¯ä»˜ (companyPayDetail)",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "readOnly": false,
              "type": "string",
              "removed": true
            },
            {
              "id": "MoneyField_41MTXVWS4KA0",
              "displayName": "DDBizSuite / æŠ¥é”€æ€»é¢ï¼ˆå…ƒï¼‰ (totalReimbursementMoney)",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "readOnly": false,
              "type": "string",
              "removed": true
            },
            {
              "id": "MoneyField_SI96SIMNSS00",
              "displayName": "DDBizSuite / å¤‡ç”¨é‡‘æ ¸é”€é‡‘é¢ï¼ˆå…ƒï¼‰ (reserveTotalAmount)",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "readOnly": false,
              "type": "string",
              "removed": true
            },
            {
              "id": "MoneyField_1Q42RS21U6PS0",
              "displayName": "DDBizSuite / æ”¯ä»˜é‡‘é¢ï¼ˆå…ƒï¼‰ (excessAmount)",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "readOnly": false,
              "type": "string",
              "removed": true
            },
            {
              "id": "MoneyField_ANZVD2X34KC0",
              "displayName": "DDBizSuite / å…¬å¸æ”¯ä»˜ï¼ˆå…ƒï¼‰ (companyAmount)",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "readOnly": false,
              "type": "string",
              "removed": true
            },
            {
              "id": "InvoiceField_1DIG7YMG9STC0",
              "displayName": "DDBizSuite / å‘ç¥¨ (electronicInvoiceOut)",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "readOnly": false,
              "type": "string",
              "removed": true
            },
            {
              "id": "InnerContactField_3GB7FEBZOE00",
              "displayName": "DDBizSuite / å½’å±äºº (principal)",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "readOnly": false,
              "type": "string",
              "removed": true
            },
            {
              "id": "DepartmentField_PEGH0CX81XC0",
              "displayName": "DDBizSuite / å½’å±éƒ¨é—¨ (recordDept)",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "readOnly": false,
              "type": "string",
              "removed": true
            },
            {
              "id": "TextareaField_Y37FR13HQV40",
              "displayName": "DDBizSuite / å¤‡æ³¨ (remark)",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "readOnly": false,
              "type": "string",
              "removed": false
            },
            {
              "id": "DDSelectField_1XZLQWFSYXKW0",
              "displayName": "DDBizSuite / é¡¹ç›® (project)",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "readOnly": false,
              "type": "string",
              "removed": true
            },
            {
              "id": "DDSelectField_MKEADHFVJO00",
              "displayName": "DDBizSuite / å®¢æˆ· (customer)",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "readOnly": false,
              "type": "string",
              "removed": true
            },
            {
              "id": "DDSelectField_110AX0A6KQV40",
              "displayName": "DDBizSuite / ä¾›åº”å•† (supplier)",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "readOnly": false,
              "type": "string",
              "removed": true
            },
            {
              "id": "RecipientAccountField_1W9VIH14Q1UO0",
              "displayName": "DDBizSuite / æ”¶æ¬¾è´¦æˆ· (recipientAccount)",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "readOnly": false,
              "type": "string",
              "removed": true
            },
            {
              "id": "DDSelectField_TM28EZM4CTC0",
              "displayName": "DDBizSuite / å•†å“ (product)",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "readOnly": false,
              "type": "string",
              "removed": true
            },
            {
              "id": "DDSelectField_17EEOYUNMG3G0",
              "displayName": "DDBizSuite / ä¼ä¸šä»˜æ¬¾è´¦æˆ· (paymentAccount)",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "readOnly": false,
              "type": "string",
              "removed": true
            },
            {
              "id": "DDSelectField_13IGHJNQCJPC0",
              "displayName": "DDBizSuite / ä¼ä¸šä¸»ä½“ (company)",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "readOnly": false,
              "type": "string",
              "removed": true
            },
            {
              "id": "DDDateField_IPVA75JDMHS0",
              "displayName": "DDBizSuite / å…¥è´¦æ—¶é—´ (recordTime)",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "readOnly": false,
              "type": "string",
              "removed": true
            },
            {
              "id": "DDDateField_OZYT60X74800",
              "displayName": "DDBizSuite / ä»˜æ¬¾æ—¶é—´ (payTime)",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "readOnly": false,
              "type": "string",
              "removed": true
            },
            {
              "id": "TextareaField_1GS86GTIT2LC0",
              "displayName": "DDBizSuite / è´¹æ§ä¿¡æ¯ (costControlServerInfo)",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "readOnly": false,
              "type": "string",
              "removed": true
            },
            {
              "id": "DDAttachment_2UM7F78HFLW",
              "displayName": "é™„ä»¶",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "readOnly": false,
              "type": "string",
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "CUSTOM.dingtalkNode",
      "typeVersion": 1,
      "position": [
        480,
        96
      ],
      "id": "0d82f9b0-6fd4-4777-83c3-297ad6c6f6eb",
      "name": "OAå®¡æ‰¹ ğŸ’æ›´æ–°æµç¨‹è¡¨å•å®¡æ‰¹å®ä¾‹",
      "credentials": {
        "dingtalkApi": {
          "id": "mEh0ffWLDuvnPoI3",
          "name": "Dingtalk account"
        }
      }
    },
    {
      "parameters": {
        "resource": "robot",
        "operation": "robot.ding.send",
        "robotCode": "={{ $('å®¡æ‰¹ä¸Šä¸‹æ–‡').first().json['DINGæ¶ˆæ¯æœºå™¨äººID'] }}",
        "receiverUserIdList": "={{ $('å®¡æ‰¹ä¸Šä¸‹æ–‡').first().json['DINGæ¶ˆæ¯æœºå™¨äººID'] }}",
        "content": "={{ $json.message }}"
      },
      "type": "CUSTOM.dingtalkNode",
      "typeVersion": 1,
      "position": [
        672,
        96
      ],
      "id": "1da03fd2-b240-46f0-af8e-485c56daf6f8",
      "name": "æœºå™¨äºº ğŸ’å‘é€DINGæ¶ˆæ¯",
      "credentials": {
        "dingtalkApi": {
          "id": "6w8TqIIZvZOYMBwM",
          "name": "Dingtalk-VmaxAI"
        }
      }
    },
    {
      "parameters": {
        "content": "## 4. éªŒè¯å‘ç¥¨ä¿¡æ¯å¹¶åé¦ˆ\n1. é€šè¿‡Codeå°†é¢„æœŸéœ€è¦éªŒè¯çš„å‘ç¥¨ã€å®¡æ‰¹å•æ®è¿›è¡Œå¯¹æ¯”ï¼ŒéªŒè¯\n2. å°†éªŒè¯ç»“æœåé¦ˆç»™é’‰é’‰",
        "height": 272,
        "width": 624
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        256,
        -336
      ],
      "id": "13b2ab3a-1270-49d2-bd83-c9f3bc98a278",
      "name": "Sticky Note4"
    },
    {
      "parameters": {
        "content": "## å¯¹äºé’‰é’‰ä¸“ä¸šç‰ˆç”¨æˆ·\n- å¯ä»¥ç•™ä¸€ä¸ªå­—æ®µè®©n8nå¤„ç†å®Œåå¡«å†™\n- é‚£ä¹ˆè´¢åŠ¡çœ‹åˆ°è¿™ä¸ªå­—æ®µåï¼Œå°±çŸ¥é“å‘ç¥¨æ˜¯å¦å¤„ç†å¥½äº†ï¼Œä»è€Œå¢åŠ æ•ˆç‡",
        "height": 320,
        "width": 624
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        256,
        -32
      ],
      "id": "e428963d-b059-41cd-b9fa-19e3263cb0a3",
      "name": "Sticky Note5"
    },
    {
      "parameters": {
        "resource": "workflow",
        "operation": "workflow.processes.instancesComments",
        "processInstanceId": "={{ $('å®¡æ‰¹ä¸Šä¸‹æ–‡').first().json['å®¡æ‰¹å®ä¾‹ID'] }}",
        "text": "={{ $json.message }}",
        "commentUserId": "={{ $('å®¡æ‰¹ä¸Šä¸‹æ–‡').first().json['æ“ä½œç”¨æˆ·'] }}",
        "file": {}
      },
      "type": "CUSTOM.dingtalkNode",
      "typeVersion": 1,
      "position": [
        672,
        -224
      ],
      "id": "a4d83d5e-9ad9-43f4-a0ef-ba2206042c4e",
      "name": "OAå®¡æ‰¹ å®¡æ‰¹è¯„è®ºï¼šéªŒè¯ç»“æœ",
      "credentials": {
        "dingtalkApi": {
          "id": "mEh0ffWLDuvnPoI3",
          "name": "Dingtalk account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.data.resource }}",
                    "rightValue": "/v1.0/event/bpms_instance_change/bizCategoryId/dingtalk.businessFinance.reimbursement/processCode/PROC-F805E01A-2C4C-476B-B1EB-F34FAC5D3BBA/type/start",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "fc30c001-e22b-4b05-9816-8ec9f2a14308"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "AIæŠ¥é”€å‘èµ·"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -784,
        -160
      ],
      "id": "5393937f-3440-4d37-bae5-c31b41cd8ed0",
      "name": "Switch1"
    },
    {
      "parameters": {
        "content": "## 1. ä½¿ç”¨è§¦å‘å™¨æ¥æ”¶æŒ‡å®šçš„äº‹ä»¶\n- ä¸åŒåœºæ™¯å¯ä»¥åˆ›å»ºä¸åŒçš„å†…éƒ¨åº”ç”¨æ¥å®ç°\n- åœ¨å†…éƒ¨åº”ç”¨çš„äº‹ä»¶è®¢é˜…é‡Œé¢ï¼Œé…ç½®å¥½å¯¹åº”çš„è®¢é˜…å†…å®¹",
        "height": 352,
        "width": 368,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -1008,
        -336
      ],
      "id": "b6770174-ab79-4e5f-a997-30d9751ea560",
      "name": "Sticky Note"
    },
    {
      "parameters": {},
      "type": "CUSTOM.dingtalkNodeTrigger",
      "typeVersion": 1,
      "position": [
        -960,
        -160
      ],
      "id": "7d3ca605-0329-4cd4-88e8-4c6a12ec216f",
      "name": "Dingtalk Node Trigger",
      "credentials": {
        "dingtalkApi": {
          "id": "mEh0ffWLDuvnPoI3",
          "name": "Dingtalk account"
        }
      }
    },
    {
      "parameters": {
        "content": "## 2. è·å–å®¡æ‰¹è¯¦æƒ…ï¼Œæå–é™„ä»¶åˆ—è¡¨",
        "height": 352,
        "width": 608,
        "color": 2
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -624,
        -336
      ],
      "id": "c60fcac1-735d-46b7-ad77-a8418586d452",
      "name": "Sticky Note6"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "2833e808-fc59-4873-828d-f96c9336895f",
              "name": "=å®¡æ‰¹å®ä¾‹ID",
              "value": "={{ $json.data.processInstanceId }}",
              "type": "string"
            },
            {
              "id": "b5c1741f-f174-4c08-9b34-76d8e763a7a0",
              "name": "æ“ä½œç”¨æˆ·",
              "value": "",
              "type": "string"
            },
            {
              "id": "c5949095-1a14-41a5-9739-c084d0b59de1",
              "name": "å®¡æ‰¹æµçš„å”¯ä¸€ç ",
              "value": "",
              "type": "string"
            },
            {
              "id": "71a45c3d-c3af-49e5-9d36-76d98049a4a9",
              "name": "DINGæ¶ˆæ¯æœºå™¨äººID",
              "value": "",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -576,
        -160
      ],
      "id": "a4969b0d-1e3e-4841-9773-e841901a0e94",
      "name": "å®¡æ‰¹ä¸Šä¸‹æ–‡"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        -960,
        96
      ],
      "id": "27ae1ab9-3a80-4f72-9a2c-91cfa7268f2b",
      "name": "When clicking â€˜Execute workflowâ€™"
    },
    {
      "parameters": {
        "content": "## æµ‹è¯•ç”¨ï¼ŒæŒ‡å®šå®¡æ‰¹å®ä¾‹",
        "height": 256,
        "width": 992,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -1008,
        32
      ],
      "id": "baa342fd-a1c3-4ccf-860f-34bee9e0f564",
      "name": "Sticky Note7"
    },
    {
      "parameters": {
        "resource": "workflow",
        "operation": "workflow.processes.instanceIds",
        "processCode": "1",
        "startTime": "2025-10-28T00:00:00",
        "statuses": [
          "RUNNING"
        ]
      },
      "type": "CUSTOM.dingtalkNode",
      "typeVersion": 1,
      "position": [
        -576,
        96
      ],
      "id": "e8498071-0443-4a97-94b4-def5bb4be2d9",
      "name": "OAå®¡æ‰¹ è·å–å®¡æ‰¹å®ä¾‹IDåˆ—è¡¨",
      "credentials": {
        "dingtalkApi": {
          "id": "mEh0ffWLDuvnPoI3",
          "name": "Dingtalk account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "74fad95f-91ff-4c83-88b2-71c3d923284c",
              "name": "data.processInstanceId",
              "value": "",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -784,
        96
      ],
      "id": "b95a02fa-ad26-4df4-bf15-5dc1fbe67476",
      "name": "æµ‹è¯•å‚æ•°"
    }
  ],
  "pinData": {},
  "connections": {
    "ä»æ§ä»¶ç»„ä¸­æå–é™„ä»¶åˆ—è¡¨": {
      "main": [
        [
          {
            "node": "Split Out",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out": {
      "main": [
        [
          {
            "node": "OAå®¡æ‰¹ ä¸‹è½½å®¡æ‰¹é™„ä»¶",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OAå®¡æ‰¹ ä¸‹è½½å®¡æ‰¹é™„ä»¶": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OAå®¡æ‰¹ è·å–å•ä¸ªå®¡æ‰¹å®ä¾‹è¯¦æƒ…": {
      "main": [
        [
          {
            "node": "ä»æ§ä»¶ç»„ä¸­æå–é™„ä»¶åˆ—è¡¨",
            "type": "main",
            "index": 0
          },
          {
            "node": "ä»æ ¹å±‚é™„ä»¶æ§ä»¶æå–åˆ—è¡¨",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "ä¸‹è½½PDF",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "OCR",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ä¸‹è½½PDF": {
      "main": [
        [
          {
            "node": "Extract from File",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract from File": {
      "main": [
        [
          {
            "node": "PDFæ ¼å¼åŒ–",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OCR": {
      "main": [
        [
          {
            "node": "Merge1",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "PDFæ ¼å¼åŒ–": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge1": {
      "main": [
        [
          {
            "node": "æ±‡æ€»å‘ç¥¨ä¿¡æ¯",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "Merge1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "æ±‡æ€»å‘ç¥¨ä¿¡æ¯": {
      "main": [
        [
          {
            "node": "å¯¹æ¯”æŠ¥é”€æ€»é¢",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "å¯¹æ¯”æŠ¥é”€æ€»é¢": {
      "main": [
        [
          {
            "node": "OAå®¡æ‰¹ å®¡æ‰¹è¯„è®ºï¼šéªŒè¯ç»“æœ",
            "type": "main",
            "index": 0
          },
          {
            "node": "OAå®¡æ‰¹ ğŸ’æ›´æ–°æµç¨‹è¡¨å•å®¡æ‰¹å®ä¾‹",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OAå®¡æ‰¹ ğŸ’æ›´æ–°æµç¨‹è¡¨å•å®¡æ‰¹å®ä¾‹": {
      "main": [
        [
          {
            "node": "æœºå™¨äºº ğŸ’å‘é€DINGæ¶ˆæ¯",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch1": {
      "main": [
        [
          {
            "node": "å®¡æ‰¹ä¸Šä¸‹æ–‡",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Dingtalk Node Trigger": {
      "main": [
        [
          {
            "node": "Switch1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "å®¡æ‰¹ä¸Šä¸‹æ–‡": {
      "main": [
        [
          {
            "node": "OAå®¡æ‰¹ è·å–å•ä¸ªå®¡æ‰¹å®ä¾‹è¯¦æƒ…",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When clicking â€˜Execute workflowâ€™": {
      "main": [
        [
          {
            "node": "æµ‹è¯•å‚æ•°",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "æµ‹è¯•å‚æ•°": {
      "main": [
        [
          {
            "node": "å®¡æ‰¹ä¸Šä¸‹æ–‡",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "9b97628e-afe3-4380-878a-e79f110d2dd1",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "38ac5f15d75e255b7f08c1c3e5483b90223067a13ec0074703142631d825e0fe"
  },
  "id": "XDPCuQRomakt0aMn",
  "tags": [
    {
      "createdAt": "2025-10-30T03:46:49.243Z",
      "updatedAt": "2025-10-30T03:46:49.243Z",
      "id": "0Ccmoxs6K6M8CvZt",
      "name": "DingTalk Node"
    }
  ]
}